{% extends base_template %}
{% load custom_tags %}
{% block content %}
<h1 class="h3 mb-3">Model Details</h1>

<div class="row">
    <div class="col-12 col-lg-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">{{ model.name }}</h5>
                <p>{{ model.description }}</p>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-4 col-xxl-3">Project</dt>
                    <dd class="col-8 col-xxl-9">
                        {{ model.project.name }}
                    </dd>
                    <dt class="col-4 col-xxl-3 mb-0">Project Owner</dt>
                    <dd class="col-8 col-xxl-9 mb-0">
                        {{ model.project.owner }}
                    </dd>
                </dl>
                <hr>
                <dl class="row">
                    <dt class="col-4 col-xxl-3">Version</dt>
                    <dd class="col-8 col-xxl-9">
                        <p class="mb-1">{{ model.version }}</p>
                    </dd>
                    <dt class="col-4 col-xxl-3 mb-0">Uploaded</dt>
                    <dd class="col-8 col-xxl-9 mb-0">
                        <p class="mb-0">{{ model.uploaded_at }}</p>
                    </dd>
                </dl>
                {% if user and user.is_authenticated and user == model.project.owner %}
                <hr>
                <dl class="row">
                    <dt class="col-4 col-xxl-3 mb-0">Tags</dt>
                    <dd class="col-8 col-xxl-9 mb-0">
                        {% with model.tags|split:"," as tags %}
                        {% for tag in tags %}
                        <span class="badge bg-success mb-1">{{ tag }}</span>
                        {% endfor %}
                        {% endwith %}
                    </dd>
                </dl>
                <form method="POST" autocomplete="off"
                                  action="{% url 'models:add_tag' published_model.id model.id %}">
                                {% csrf_token %}

                                <div class="mb-3 row">
                                    <dt class="col-4 col-xxl-3 mb-0">Add Tag</dt>
                                    <dd class="col-8 col-xxl-9 mb-0">
                                        <input id="id_access" type="text" name="tag" required
                                                class="form-control" list="add_tags"/>
                                            <datalist id="add_tags">
                                            <!-- <option selected>
                                                {{ model.get_access_display }}
                                            </option> -->
                                            {% for tag in all_tags %}
                                            <option value="{{ tag }}">{{ tag }}</option>
                                            {% endfor %}
                                            </datalist>
                                        <button type="submit" class="btn btn-info btn-sm">
                                            <i class="fas fa-save"></i>
                                            Add
                                        </button>
                                    </dd>
                                </div>
                            </form>
                            <form method="POST" autocomplete="off"
                            action="{% url 'models:remove_tag' published_model.id model.id %}">
                          {% csrf_token %}

                          <div class="mb-3 row">
                              <dt class="col-4 col-xxl-3 mb-0">Remove Tag</dt>
                              <dd class="col-8 col-xxl-9 mb-0">
                                  <input id="id_access" type="text" name="tag" required
                                          class="form-control" list="remove_tags"/>
                                      <datalist id="remove_tags">
                                      <!-- <option selected>
                                          {{ model.get_access_display }}
                                      </option> -->
                                      {% with model.tags|split:"," as tags %}
                                      {% for tag in tags %}
                                      <option value="{{ tag }}">{{ tag }}</option>
                                      {% endfor %}
                                      {% endwith %}
                                      </datalist>
                                  <button type="submit" class="btn btn-danger btn-sm">
                                      <i class="fas fa-save"></i>
                                      Remove
                                  </button>
                              </dd>
                          </div>
                      </form>
                {% endif%}
                <hr>
                <a href="{{ media_url }}{{ latest_model_obj.obj }}">Download</a>
            </div>
        </div>
        
        <div class="card">
            {% if model.model_card %}
            <div class="card-header">
                <h5 class="card-title mb-0">Model Card</h5>
            </div>
            <div class="card-body">
            {{ model.model_card | safe }}
            </div>
            {% else %}
            <div class="card-body">
                <p>No model card available.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
